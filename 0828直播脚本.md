# 0828直播脚本

## 直播主题
Trae七周实战训练营——第四课：玩家身份识别！构建安全可靠的用户登录系统

## 直播内容
### 一、课程导引

#### 飞哥：
大家好，欢迎大家来到Trae七周实战训练营的第四节课，我是你们的老朋友沈飞。

#### 刘泓：
大家好，我是今天的主讲人刘泓。

#### 飞哥：
上节课我们成功地将贪吃蛇游戏的排行榜数据从文件存储升级到了数据库，解决了数据丢失的问题！
现在我们有了数据库存储排行榜，但还有个问题没解决。
**🎬 01-展示当前游戏排行榜界面**
我先给大家看一下我们的排行榜...（展示排行榜）大家看，上面只有名字，没有任何身份信息，评论区的各位伙伴想一想，现在排行榜都存在哪些问题？

#### 刘泓：
现在存在的问题：
● 玩家身份识别问题：任何人都可以随便输入名字上榜，同一个人可以用不同名字重复上榜，无法知道这些分数是谁创造的
● 临时数据问题：未提交成绩之前刷新页面，就找不到自己的成绩了  
● 数据安全问题：无法防止有人恶意刷分
● 玩家没有成长感：没有个人游戏历史记录

#### 飞哥：
所以我们需要让每个玩家都能拥有自己的身份，那么我们该怎么做呢？

#### 刘泓：
这就需要为游戏添加用户登录系统，今天我们会学习如何用vibe coding的方式给游戏制作一个用户登录系统，让你的玩家拥有自己的账号，让排行榜显示真实的用户信息！

#### 飞哥：
从第二节课到第四节课，我们可以说是带大家跨越了20多年的游戏发展历程。
稍微有点年纪的伙伴可能会知道，游戏行业从70年代兴起，早期的游戏以“街机”的形式发行，都是单机游戏，没有登录需求。
后来90年代PC与主机网络服务的爆发，促成了网络游戏的兴起，推动了账户系统的发展。其中，里程碑事件是1996年暴雪推出的“战网”游戏平台，玩家需要通过账号登陆暴雪的游戏，并集成了好友列表、战绩统计功能。

说到这里，我们本期的礼物就是一款怀旧游戏机——“拓麻歌子”，这是一款90年代爆火的现象级产品——虚拟宠物养成游戏机，开创了“情感化交互电子玩具”的先河，像现在很火的《动物森友会》的情绪陪伴设计就源自拓麻歌子逻辑。
老规矩，我们会有3次送礼的时机，大家要准备好抢答题目或完成任务，就可以获得今天的小礼物！
同时，互动榜第一的同学也会额外获得一个神秘奖品。

### 二、知识点1：用户体系与数据库关联设计

#### 飞哥：
言归正传，说到用户体系我们都可以理解，但是这个体系是怎么组建的呢？

#### 刘泓：
可以用银行举例，没有用户登录系统就像银行不需要身份证就能开户一样，而解决办法就是建立一个银行账户管理系统，让身份证和交易记录可以关联起来。
这涉及到我们今天要讲的第一个知识点：数据库关联表设计。
通过建立两个相互关联的表，来将身份信息和交易信息关联起来：
● 身份证档案（用户表）：记录每个人的真实身份
● 银行交易记录（排行榜表）：每笔交易都关联到具体的身份证号

上节课我们知道了数据库是什么、如何建立一个单表数据库，这节课我们来把它进化为双表数据库。
想要在游戏中实现一个基础的用户登录系统，我们需要这样的两个数据表：

用户表（users）- 身份证档案：
```
id | username | nickname | password_hash
---|----------|----------|-------------
1  | user001  | 小明     | 
2  | user002  | 小红     | 
3  | user003  | 游戏高手  | 
```

排行榜表（leaderboard）- 游戏记录：
```
id | user_id | score | timestamp
---|---------|-------|----------
1  | 1       | 500   | 2024-01-01
2  | 2       | 450   | 2024-01-01
3  | 3       | 600   | 2024-01-01
```
看！现在每个分数都有对应的用户ID，不会再出现随意填写名称的情况了。

#### 飞哥：
这样设计有什么好处呢？

#### 刘泓：
好处1：真实性保证
● 排行榜显示的是注册用户的真实昵称
● 每个昵称背后都有真实的用户账户

好处2：数据可追溯
● 知道每个分数是谁创造的
● 可以管理具体用户的行为

好处3：个人历史查询
● 用户可以查看自己的所有游戏记录
● 通过用户ID筛选个人数据

好处4：防止重复作弊
● 同一用户无法重复提交相同时间段的分数
● 系统能识别异常行为

这就是数据库设计的魅力：通过合理的表结构关联，解决实际的业务问题！
我们今天只学习到双表设计，实际的使用中会有更多的复杂场景，比如多表关联查询、事务处理等。

#### 飞哥：
不过，现在虽然有两个表了，如何这还是独立的两个表格，我们需要怎么把它们关联起来？

#### 刘泓：
这就需要用到数据库的关联查询。
关联查询可以根据两个表之间的关联字段，将它们合并成一个结果集。
比如，我们可以根据用户表的id字段，查询出排行榜表中所有属于该用户的游戏记录。

上节课我们学习了“主键”的概念，主键是每个表中唯一标识一条记录的字段。
在用户表中，id字段就是主键，每个用户的id都是唯一的。
在排行榜表中，user_id字段就是关联字段，它引用了用户表的id字段。
通过关联字段，我们可以将两个表连接起来，实现数据的关联查询。

在进行数据关联查询时，我们会用到sql语言中的“JOIN查询”！

**🎬 04-展示JOIN查询代码**
就像银行查账时，通过身份证号找到客户姓名一样

实际的查询逻辑：
```sql
-- 获取实名排行榜
SELECT 
    u.nickname,  -- 从用户表获取昵称
    l.score,     -- 从排行榜表获取分数
    l.timestamp  -- 从排行榜表获取时间
FROM leaderboard l 
JOIN users u ON l.user_id = u.id  -- 通过用户ID关联两个表
ORDER BY l.score DESC;
```

#### 飞哥：
大家不用担心看不懂SQL，AI会帮我们生成这些代码！重要的是理解这个关联思路。
接下来进入我们今天的第一个送礼环节，我们先来一道抢答题热热身！

**🎬 05-展示抢答题1**
```
抢答题1：多表关联设计的优势包括哪些？（多选）
A. 数据真实性保证，每个记录都有明确身份
B. 支持个人历史数据查询
C. 可以防止恶意刷分和作弊
D. 占用存储空间更小
答案：A、B、C
```

### 三、实操：AI生成用户登录系统并升级数据库

#### 飞哥：
现在大家理解了双表设计的基本原理了，我们来让AI帮我们执行吧！
我是不是直接告诉Trae"帮我做个用户系统"就可以了？

#### 刘泓：
这样说的话，AI会无法精准理解我们的需求，做出来的系统可能不是我们想要的效果。

#### 飞哥：
那我应该怎么说？请泓老师演示一下高端操作！

#### 刘泓：
**🎬 投屏演示**
现在重点来了！如何让AI理解我们要做"数据表关联"？
正确的做法，是要用通俗的语言描述清楚我们的具体需求：
```
我有一个贪吃蛇游戏，现在的排行榜有个问题：

【当前情况】
- 任何人都可以随便输入名字，比如输入"游戏大神"
- 没办法知道这些分数到底是谁的
- 同一个人可以用不同名字反复上榜

【我想要的效果】
- 用户需要先注册账号才能玩游戏
- 排行榜显示的是真实的用户昵称
- 每个用户可以查看自己的历史成绩
- 防止有人作弊刷分

请帮我加上用户注册登录系统，让游戏能认识每个玩家。
```
看！我们重点描述了数据结构的变化和关联需求，这样AI就知道要做什么了！

（点击发送，等待AI回复）
太棒了！AI完美理解了我们的数据关联需求！让我们看看AI的设计方案！

1. 用户表设计（身份证档案）：
```sql
CREATE TABLE users (
    id INTEGER PRIMARY KEY,           -- 用户唯一身份ID
    username VARCHAR(50) UNIQUE,      -- 登录用户名（不能重复）
    nickname VARCHAR(50),             -- 显示昵称  
    password_hash VARCHAR(255),       -- 加密密码
    created_at TIMESTAMP             -- 注册时间
);
```
就像给每个人发了一张身份证！

2. 排行榜表升级（交易记录）：
```sql
-- 升级后的表结构  
CREATE TABLE leaderboard (
    id INTEGER PRIMARY KEY,
    user_id INTEGER,              -- 关键：关联到用户表的ID
    score INTEGER,
    timestamp DATETIME,
    FOREIGN KEY (user_id) REFERENCES users(id)  -- 外键约束
);
```
看！现在每个分数都有明确的主人了！

3. 数据关联查询（核心魔法）：
```sql
-- 实名排行榜查询
SELECT 
    u.nickname AS 玩家昵称,
    l.score AS 游戏分数,
    l.timestamp AS 游戏时间
FROM leaderboard l 
JOIN users u ON l.user_id = u.id    -- 通过user_id关联两个表
ORDER BY l.score DESC 
LIMIT 10;
```
就像银行通过身份证号查找客户所有交易记录！

4. 前端登录注册页面：
AI还为我们生成了简洁的用户界面！

#### 飞哥：
我还有一个疑问，用户登录后，分数是如何自动绑定到用户的？

#### 刘泓：
AI生成的后端逻辑很巧妙：
```python
# 用户提交分数时
def submit_score(score):
    user_id = session.get('user_id')  # 获取当前登录用户ID
    if user_id:
        # 分数自动绑定到用户
        cursor.execute("INSERT INTO leaderboard (user_id, score, timestamp) VALUES (?, ?, ?)", 
                      (user_id, score, datetime.now()))
    else:
        return "请先登录"
```
这样系统就知道每个分数是谁创造的了！

#### 飞哥：
让我们出第二道抢答题！
**🎬 08-展示抢答题2**
```
抢答题2：SQL查询语句 "SELECT u.nickname, l.score FROM leaderboard l JOIN users u ON l.user_id = u.id" 的作用是？
A. 删除用户和分数数据
B. 通过关联查询显示用户昵称和对应分数
C. 创建新的用户表
D. 更新用户密码
答案：B
```

### 四、部署测试：看看实际效果
#### 飞哥：
现在让我们把AI生成的代码部署起来，看看实际效果！

#### 刘泓：
**🎬 投屏演示**

升级步骤很简单：
1. 创建用户数据表
2. 更新后端服务代码
3. 添加登录注册页面
4. 重启服务

（演示实际操作过程）

现在让我们测试升级效果！

测试1：用户注册
我现在注册一个新账号"测试用户001"
（实际操作注册流程）
看！系统成功创建了用户档案！

测试2：用户登录
现在我用刚才注册的账号登录
（实际操作登录流程）  
登录成功！系统已经认识我是谁了！

测试3：数据关联效果
现在我来玩一局游戏，看看数据表关联是否生效！
（实际玩游戏，提交分数）
太神奇了！分数自动绑定到user_id=1，系统知道这是"测试用户001"的成绩！

测试4：实名排行榜的数据关联
让我们看看JOIN查询的实际效果
（展示排行榜页面）
看！排行榜通过JOIN查询，显示的是users表中的真实昵称，而不是随意输入的名字！

测试5：个人历史的数据筛选
现在查看个人记录，看看数据筛选效果
（展示个人记录页面）
完美！通过WHERE user_id=1的条件，系统只显示当前用户的历史记录！

#### 飞哥：
**🎬 展示游戏地址**
现在大家都可以通过网址登陆并注册我们的游戏了，快来试试吧！
今天的最后一个礼物，就从我们游戏的第一批用户中抽取——现在开始计时，3分钟后，从用户id中随机抽取一名幸运中奖者！

### 五、尾声
#### 飞哥：
在大家体验我们游戏的同时，请泓老师对今天的知识点做一个总结吧！

#### 刘泓：
**🎬 11-展示知识点总结**

今天我们学会了：
1. 用户体系设计：理解用户表和业务表的关联关系
2. 多表关联查询：学会用JOIN查询解决实际业务问题
3. 数据完整性：通过外键约束保证数据一致性  

#### 飞哥：
现在我们的游戏已经有了完整的用户体系，并收获了第一批种子用户。现在我作为游戏开发者，我想通过数据来判断大家喜不喜欢我的游戏，比如，我想知道用户平均游戏时长、最常玩的时间段、用户留存率等数据，应该怎么办呢？

#### 刘泓：
下期我们将学习更复杂的数据分析——引入用户行为分析表，学会多表关联的数据挖掘！

#### 飞哥：
我们的课程逐渐深入，理论说得再多，不如实际操作一遍！大家可以通过课后作业巩固课上所学的知识。
**🎬 10-展示课后作业说明**
本周的课后作业：为你们的游戏或应用添加一个用户注册登录系统，实现用户表和业务数据表的关联，支持用户身份认证和个人数据查询。

接下来是大家喜闻乐见的送礼环节～
首先，我们获取到了当前游戏的所有注册用户，进行抽奖。
**🎬 11-展示抽奖画面**
中奖用户是xx，恭喜你获得今天第三个“拓麻歌子”礼物。
接下来，是本场互动榜第一的用户，昵称是xx，也恭喜你获得神秘礼物！

那我们本期内容就到这里，感谢大家的积极参与，记得完成我们的课后测验和作业，及时巩固自己的学习效果，下周同一时间我们不见不散！








