# 0821直播脚本

## 直播主题
Trae七周实战训练营——第三课：排行榜升级！从文件存储升级到专业数据库

## 直播内容
### 一、课程导引

#### 飞哥：
大家好，欢迎大家来到Trae七周实战训练营的第三节课，我是你们的老朋友沈飞。

#### 刘泓：
大家好，我是今天的主讲人刘泓。

#### 飞哥：
经过前两期的学习，我们已经有了一个带排行榜的贪吃蛇游戏！
我们先复习一下上节课的知识点，上节课我们学习了用文件存储的方式存储数据，这个文件即可以存放在本地、也可以存放在云端。
上节课我们用JSON文件存储排行榜数据，看起来挺好的，为什么还要升级呢？

#### 
因为文件存储的方式有很多缺点，比如人多时可能出错（并发问题）、数据量大时查找速度较慢、数据容易丢失。

#### 飞哥：
具体到我们的游戏，会有什么问题呢？

#### 刘泓：
**🎬 01-展示对比表格**
| 对比项目 | 文件存储 | 数据库 |
|---------|---------|--------|
| 数据安全 | 😰 容易丢失 | 😎 银行级安全 |
| 多人使用 | 😵 容易冲突 | 🚀 轻松应对 |
| 查询速度 | 😐 越来越慢 | ⚡ 秒级响应 |
| 功能扩展 | 😅 需要重写 | 😌 轻松添加 |

具体到游戏的问题就是：
1. 数据丢失风险：服务器重启，数据就没了
2. 并发问题：两个人同时提交分数可能出错
3. 查询困难：想找特定用户的历史记录很麻烦
4. 扩展困难：想加新功能需要重写很多代码

#### 飞哥：
那我们应该如何解决这个问题？

#### 刘泓：
我们需要把文件存储升级到数据库来解决。
**🎬 02-展示超市示意图**
让我用一个生活化的比喻来解释。想象你是一个超市老板：

现在的方式（文件存储）：
 你用一个大账本记录所有商品：可乐50瓶、面包30个...
 每次有人买东西，你就在账本上改数字
 但是账本容易丢失、损坏，而且很多人同时要用时就会乱

升级后的方式（数据库）：
 你安装了一套智能仓库管理系统
 每个商品都有电子标签，自动记录进出
 系统有备份，永远不会丢失数据
 100个员工可以同时查询，互不干扰

#### 飞哥：
那么这节课我们就会带着大家一起，用vibe coding的方式，给我们的小游戏建一个数据库！
有了数据库，相当于可以给每个玩家打一个标签，比如显性的“战绩”、“身份”，或者技术层的“时间”、“版本”等。

标签可以帮助我们更好的整理、查找数据，所以今天我们的礼物就是——“标签打印机”，让你可以在生活中也整理得井井有条！
老规矩，我们在直播中会不定时出3道抢答题，每轮答题中第一名回答正确的小伙伴将获得本期的小礼物。
此外直播互动值第一的小伙伴也将额外获得一件神秘礼物，大家要积极参与点赞、评论、互动！

### 二、知识点1：数据库原理

#### 飞哥：
言归正传，上节课我们提到了数据存储的两种方式，文件存储和数据库，那么数据库到底是什么呢？

#### 刘泓：
数据库本质上是一个​​结构化数据的智能仓库​​。它通过表结构建立数据之间的逻辑关系（比如用户表和订单表的关联），提供四大核心能力：
1.持久化存储​​ - 数据断电不丢失
2.​高效检索​​ - 用索引实现毫秒级查询
3.​并发控制​​ - 支持多人同时操作
4.​​数据安全​​ - 权限管理和自动备份

#### 飞哥：
数据库到底是一个程序、一个系统、还是一种文件类型？

#### 刘泓：
它其实是三者的结合体：
1.​​运行程序​​：像MySQL这样的守护进程(daemon)，持续监听数据请求
2.​​管理系统​​：提供操作界面（SQL命令行/GUI工具）
3.​​文件集合​​：实际数据存储在.frm(表结构).ibd(数据)等文件中

就像视频播放器：
∙播放器软件 ≈ 数据库程序
∙播放列表 ≈ 数据管理逻辑
∙视频文件 ≈ 物理存储数据

#### 飞哥：
我们需要提前安装MySql数据库吗？

#### 刘泓：
我们可以使用轻量级的SQLite数据库，它是​​零配置、无服务端的嵌入式数据库​​，直接读写本地文件，不需要安装，直接使用即可。
SQLite可以把程序+数据打包成单个文件，就像把播放器和电影合并成.exe文件。

#### 飞哥：
如果还是读写本地文件，为什么说它比文件存储的形式安全可靠呢？

#### 刘泓：
这个问题问得非常到位！确实，​​SQLite也是一个文件​​（.db文件），但它是"智能容器"而不仅是数据存储，通过以下机制实现了远超普通文件存储的安全性​：
1.​​原子事务​​ - 写入不可分割
2.并发控制​​ - 自动排队管理
3.崩溃恢复​​ - WAL日志保护
4.数据约束​​ - 主动防错机制

可以想象成两种存钱罐：
​1. ​JSON文件​​：普通玻璃罐，每次存钱要把所有硬币倒出来重数（全量读写），邻居小孩还能伸手偷拿（并发冲突）
2. ​​SQLite文件​​：带密码锁的电子存钱罐，存钱时：
    1.先开小窗口放硬币（增量写入）
    2.自动记账本（WAL日志）
    3.关门自动上锁（事务锁）
即使突然地震（断电），最多损失正在存的那枚硬币（单次操作），而不是整个钱罐摔碎

#### 飞哥：
那么数据库是如何存储数据的？

#### 刘泓：
数据表的结构一点都不复杂，就像一个超级智能的Excel表格！

**🎬 03-展示JSON与数据表对比**

看，我们现在的JSON文件：
```json
[
  {"name": "小明", "score": 150, "time": "2023-05-01"},
  {"name": "小红", "score": 120, "time": "2023-05-01"}
]
```

转换成数据库表格后：
```
leaderboard表
+----+------+-------+---------------------+
| id | name | score | timestamp          |
+----+------+-------+---------------------+
| 1  | 小明 | 150   | 2023-05-01 10:00  |
| 2  | 小红 | 120   | 2023-05-01 11:00  |
+----+------+-------+---------------------+
```
#### 飞哥：
如果两个人都叫“小明”，怎么区分谁是谁呢？

#### 刘泓：
在回答这个问题之前，我先给大家讲一讲，数据表数据表设计的关键原则：
1. 主键：每一张表必须有一个主键，具有唯一性、非空性，就像每个人的工号一样不重复，作为识别这一组数据的标识。
2. 避免数据冗余：一个信息应该尽量只在一个地方存储。如果多个表需要相同信息（如用户名），应通过主键-外键引用关联的表，而不是在每个表里都存储一份用户名。
3. 列的原子性：每一列应该存储​​单一、不可再分​​的数据项。
4. ​正确选择数据类型：为每一列选择最合适的、最精确的数据类型（如 SQLite 中的 INTEGER, TEXT, REAL, BLOB, NUMERIC；MySQL 中的多种整型、浮点型、字符串型、日期时间型等）。
5. 定义外键约束：一个表（子表）中的一列（或多列）引用了另一个表（父表）的主键。

回到刚才的问题，即使用户都叫“小明”，我们可以通过user_id这一“主键”来区分他们。

#### 飞哥：
那我们怎么和数据库"说话"，查询我们需要的数据呢？

#### 刘泓：
这就要用到SQL语言了！SQL就像是和数据库管家对话的"普通话"。

最简单的SQL查询：
```sql
SELECT * FROM leaderboard;
```
翻译成人话就是："请把排行榜表的所有数据都给我看看"

查找高分玩家：
```sql
SELECT name, score FROM leaderboard WHERE score > 100;
```
翻译成人话："请给我看看分数大于100的玩家姓名和分数"

大家不会写SQl也没关系，AI会帮我们生成这些SQL语句！

#### 飞哥：
我们出第一道抢答题！
**🎬 03-展示抢答题1**
```
抢答题1：数据库相比文件存储的优势包括哪些？（多选）
A. 数据安全性更高，有自动备份
B. 支持多人同时访问，无冲突
C. 查询速度快，支持复杂查询
D. 占用存储空间更小
答案：A、B、C
```

### 三、实操：AI帮我们升级到数据库

#### 飞哥：
现在我们了解了数据库的基本原理，但是理论说得再多，不如实际操作一遍！请泓老师演示如何用AI帮我们升级到数据库！

#### 刘泓：
**🎬 投屏演示**
现在我要告诉AI我们的具体需求。关键是要描述清楚现状和问题：
```
我们的贪吃蛇游戏现在用JSON文件存储排行榜数据，请帮我们升级到使用mysql数据库
```
这样AI就给我们生成了完整的升级方案！

#### 飞哥：
在这个过程中，AI帮我们做了什么？

#### 刘泓：
1. 创建数据库表：
```sql
CREATE TABLE leaderboard (
    id INTEGER PRIMARY KEY,
    name TEXT NOT NULL,
    score INTEGER NOT NULL,
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

2. 升级后端代码：
```python
import sqlite3

# 连接数据库
conn = sqlite3.connect('gamedata.db')

# 提交分数到数据库
def save_score(name, score):
    cursor = conn.cursor()
    cursor.execute("INSERT INTO leaderboard (name, score) VALUES (?, ?)", 
                   (name, score))
    conn.commit()
```

3. 获取排行榜：
```python
def get_leaderboard():
    cursor = conn.cursor()
    cursor.execute("SELECT name, score FROM leaderboard ORDER BY score DESC LIMIT 10")
    return cursor.fetchall()
```

#### 飞哥：
所以我们其实不需要安装任何其他软件，只需要告诉AI一句话，“我们的贪吃蛇游戏现在用JSON文件存储排行榜数据，请帮我们升级到使用mysql数据库”，AI就帮我们完成了全过程。
对于用户来说，从他们的角度来看，从JSON文件升级到数据库，会感知到什么变化吗？

#### 刘泓：
因为我们只是改变了后端存储数据的形式，没有改变前端界面、或者增加用户登录等交互动作，所以对于用户来说，感知不到变化。
但这就像银行升级了保险柜系统，你存取钱的体验没变，但钱变得更安全了！

#### 飞哥：
让我们出第二道抢答题！
**🎬 07-展示抢答题2**
```
抢答题2：SQL查询语句 "SELECT name FROM leaderboard WHERE score > 500" 的含义是？
A. 删除分数大于500的玩家
B. 查找分数大于500的玩家姓名
C. 更新分数大于500的玩家信息
D. 创建新的排行榜表
答案：B
```

### 四、部署测试升级效果

#### 飞哥：
接下来，请泓老师给我们简单讲讲，如何把数据库部署到线上，替换我们之前的文件存储的形式。
关于部署的知识，大家了解原理即可，不需要掌握如何操作。

#### 刘泓：
**🎬 投屏演示**

升级步骤很简单：
（演示实际操作过程）
1. 运行数据库初始化脚本
2. 替换新的后端代码
3. 重启服务

现在让我们测试升级效果！

测试1：提交新分数
我来玩一局游戏...看，分数成功保存到数据库了！

测试2：服务器重启测试
现在我重启服务器...（重启后）太棒了！数据还在！

测试3：多人同时访问
我用两个浏览器窗口同时访问...完全没问题！

测试4：查询功能
现在我们可以轻松查询历史数据了！

#### 飞哥：
现在大家可以通过网址登陆我们的游戏了，当然大家可能感受不到和上次有什么变化，因为我们本期是后台的升级。
今天我们的最后一个礼物，还是用打游戏的方式送出，上次游戏榜单的巅峰对决太精彩了，这次我们照顾一下像我一样的游戏小白，让大家有点参与感。
这次的规则是：从现在开始计时3分钟，3分钟后，我们会从榜单上前10名玩家中随机抽取一位送出礼物。
**🎬 09-展示游戏地址**

### 六、尾声

#### 飞哥：
在大家玩游戏的期间，请泓老师给我们总结一下今天的知识点吧。

#### 刘泓：
**🎬 10-展示知识点总结**

今天我们学会了：
1. 数据库原理：数据库本质上是一个​​结构化数据的智能仓库​​。它通过表结构建立数据之间的逻辑关系（比如用户表和订单表的关联），提供四大核心能力：持久化存储​​、​高效检索​​、​并发控制​​、​数据安全。
2. 通过AI进行数据库升级：看懂SQLite和sql。

有了数据库，我们的产品从"玩具级别"升级到了"商业级别"！

#### 飞哥：
时间到了，泓老师可以给我们展示一下数据库中已有的数据吗？

#### 刘泓：
**🎬 投屏演示**
大家看，排行榜在数据库中是以这样的形式存储的。

#### 飞哥：
大家可以看到，前十名的数据都在这里了，现在我们开始抽奖，幸运用户是xx，恭喜你获得礼物！
现在我们的游戏数据已经很安全了，但还有个问题：排行榜上的名字都是大家随便起的，谁知道背后对应的是谁呢？比如这个叫“泓老师”的真的是你吗？

#### 刘泓：
下期我们将解决身份识别问题，建立用户登录系统，让排行榜显示真实的用户信息！

#### 飞哥：
那我们本期的课程就到这里了，从这节课开始，因为课程难度提升了，所以我们会在群里发布课后问卷，大家在实操过程中有什么疑问可以填写在问卷上，我们会在下一期给大家解答。

**🎬 11-展示课后作业说明**
本周的课后作业：将你们游戏或应用升级到数据库存储。

**🎬 12-展示积分榜**
最后我们揭晓今天的互动榜第一，是xxx，将获得本期礼品一份。

记得完成我们的课后测验和作业，及时巩固自己的学习效果，下周同一时间我们不见不散！




### 测验题：
一、单选题题库

  1. 根据直播内容，文件存储方式的主要问题是什么？
  A. 文件会被自动删除
  B. 两个人同时提交分数可能出现数据冲突
  C. 文件格式不支持中文
  D. 占用磁盘空间太大
  答案：B

  2. 在第三期直播中，为什么要从文件存储升级到数据库？
  A. 因为JSON文件太大了
  B. 因为要解决并发访问和查询困难的问题
  C. 因为老师更喜欢数据库
  D. 因为数据库看起来更专业
  答案：B

  3. SQL语句 SELECT * FROM leaderboard 翻译成人话是什么意思？
  A. 删除排行榜表的所有数据
  B. 请把排行榜表的所有数据都给我看看
  C. 创建一个新的排行榜表
  D. 备份排行榜数据
  答案：B


  4. 完成数据库升级后，用户在游戏体验上会感受到什么变化？
  A. 游戏界面变得更美观
  B. 游戏操作更加流畅
  C. 完全感觉不到任何变化
  D. 需要重新学习游戏规则
  答案：C


  ---
  二、多选题题库

  5. 数据库相比文件存储的优势包括哪些？（多选）
  A. 数据安全性更高，有自动备份
  B. 支持多人同时访问，无冲突
  C. 查询速度快，支持复杂查询
  D. 占用存储空间更小
  答案：ABC


  6. 完成数据库升级后，游戏获得了哪些新能力？（多选）
  A. 数据持久化
  B. 支持更多并发用户
  C. 可以进行复杂的数据查询
  D. 游戏界面变得更美观
  答案：ABC


  7. 在对比表格中，数据库在哪些方面优于文件存储？（多选）
  A. 数据安全：银行级安全 vs 容易丢失
  B. 多人使用：轻松应对 vs 容易冲突
  C. 查询速度：秒级响应 vs 越来越慢
  D. 功能扩展：轻松添加 vs 需要重写
  答案：ABCD


  ---
  三、判断题题库

  8. SQL语言就像是和数据库管家对话的"普通话"。（　）
  答案：正确


  9. 数据库就像一个超级智能的Excel表格。（　）
  答案：正确


  10. AI可以帮助我们生成SQL语句，无需手动编写。（　）
  答案：正确



