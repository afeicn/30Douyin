# 0821直播脚本

## 直播主题
Trae七周实战训练营——第三课：排行榜升级！从文件存储升级到数据库

## 直播内容
### 一、课程导引

#### 飞哥：
大家好，欢迎大家来到Trae七周实战训练营的第三节课，我是你们的老朋友沈飞。

#### 刘泓：
大家好，我是今天的主讲人刘泓。

#### 飞哥：
经过前两期的学习，我们已经有了一个带排行榜的贪吃蛇游戏！
我们先复习一下上节课的知识点。上节课我们学习了用文件存储的方式存储数据，看起来挺好的，为什么还要升级呢？

#### 
因为文件存储的方式有很多缺点，比如人多时可能出错（并发问题）、数据量大时查找速度较慢、数据容易丢失。

#### 飞哥：
具体到我们的游戏，会有什么问题呢？

#### 刘泓：
**🎬 01-展示对比表格**
| 对比项目 | 文件存储 | 数据库 |
|---------|---------|--------|
| 多人使用 | 😵 容易冲突 | 🚀 轻松应对 |
| 查询速度 | 😐 越来越慢 | ⚡ 秒级响应 |
| 功能扩展 | 😅 需要重写 | 😌 轻松添加 |

具体到游戏的问题就是：
1. 并发问题：两个人同时提交分数可能出错
2. 查询困难：想找特定用户的历史记录很麻烦
3. 扩展困难：想加新功能需要重写很多代码

1. 文件为什么会因为数据冲突而丢失数据？
因为数据写入的具体形式——全量覆盖，比如有10行数据，现在要写入第11行，如果很多人同时写入第11行，那最后就只会保留一个人的数据。
2. 数据查找为什么会越来越慢？
文件查找是顺序查找、全文检索。

**🎬 02-展示超市示意图**
让我用一个生活化的比喻来解释。想象你是一个超市老板：

现在的方式（文件存储）：
 你用一个大账本记录所有商品：可乐50瓶、面包30个...
 每次有人买东西，你就在账本上改数字
 如果多个人排队，就需要等待收银员一页一页记账
 但是如果多个收银员，每人一个账本，又会导致不知道哪些货已经卖完了

#### 飞哥：
那我们应该如何解决这个问题？

#### 刘泓：
数据库引入了一些机制来解决这些问题，包括主键、索引、加锁等。

#### 飞哥：
哪个机制是解决的数据查询问题？

#### 刘泓：
索引机制，就是通过创建索引来加速数据查询的过程。索引就像新华字典的目录一样，它记录了数据的位置，所以当我们查询某个值时，数据库可以直接跳转到该值的位置，而不需要遍历整个表。

#### 飞哥：
哪个机制是解决的”写入冲突“问题？

#### 刘泓：
通过主键、加锁的方式，可以确保在写入数据时，不会被其他事务干扰，从而避免数据冲突。
1. 加锁机制，就是在写入数据时，会给数据加上一个锁，其他事务想要写入数据，就必须等待锁释放。    
2. 主键机制，就是每个数据都有一个唯一的标识符，当我们要写入数据时，会先检查主键是否存在，如果不存在，就可以写入；如果存在，就会报错，避免数据冲突。
有了这两个机制，数据的安全性就得到了保障。

#### 飞哥：
那么这节课我们就会带着大家一起，用vibe coding的方式，给我们的小游戏建一个数据库！

**🎬 03-展示礼物图片**
老规矩，我们在直播中会不定时出3道抢答题。由于部分同学反映，抢答没有参与感，所以我们这次稍微改一下规则。
这次每道题前三名回答正确的同学会获得抽奖资格，在直播的最后，我们会从这9名同学中抽出3位，送出本期的小礼物——《浪浪山小妖怪》工牌套盲盒。

此外直播互动值第一的小伙伴也将额外获得我从广州带回来的土特产，一共有两盒哦！（展示）大家要积极参与点赞、评论、互动！

现在我们来热热身，出第一道抢答题！
**🎬 04-展示抢答题1**
```
抢答题1：数据库相比文件存储的优势包括哪些？（多选）
A. 数据安全性更高，有自动备份
B. 占用存储空间更小
C. 支持多人同时访问，无冲突
D. 查询速度快，支持复杂查询

答案：ACD
```

### 二、知识点1：数据库原理

#### 飞哥：
言归正传，上节课我们提到了数据存储的两种方式，文件存储和数据库，那么数据库到底是什么呢？

#### 刘泓：
数据库就像一个有特殊要求的Excel表格！

**🎬 05-展示JSON与数据表对比**

看，我们现在的JSON文件：
```json
[
  {"name": "小明", "score": 150, "time": "2023-05-01"},
  {"name": "小红", "score": 120, "time": "2023-05-01"}
]
```

转换成数据库表格后：
```
leaderboard表
+----+------+-------+---------------------+
| id | name | score | timestamp          |
+----+------+-------+---------------------+
| 1  | 小明 | 150   | 2023-05-01 10:00  |
| 2  | 小红 | 120   | 2023-05-01 11:00  |
+----+------+-------+---------------------+
```
**🎬 06-展示数据库规则总结**
数据表的特殊要求：
1. 主键：每一张表必须有一个主键，具有唯一性、非空性，就像每个人的工号一样不重复，作为识别这一组数据的标识。
2. 列的原子性：每一列应该存储​​单一、不可再分​​的数据项。
3. ​正确选择数据类型：为每一列选择最合适的、最精确的数据类型（如 SQLite 中的 INTEGER, TEXT, REAL, BLOB, NUMERIC；MySQL 中的多种整型、浮点型、字符串型、日期时间型等）。
4. 索引：为经常查询的列添加索引，提高查询速度。

#### 飞哥：
日常使用的数据库有哪些？

#### 刘泓：
日常使用的数据库有很多种，比如MySQL、SQLite、PostgreSQL、Oracle等。

**🎬 07-展示数据表构成**
1. 库：数据库的容器，用来组织和管理多个表。
2. 表：数据库中的基本单位，用来存储数据。
3. 字段：表中的列，用来描述数据的属性。
4. 记录：表中的行，用来存储具体的数据。

**🎬 投屏演示-数据表构成**
演示：（对照实际表格讲解各部分）
写程序的时候，用sql中的insert语句，产生一条记录，就插入进来一条。

#### 飞哥：
大家需要掌握insert语句吗？

#### 刘泓：
vibe coding可以帮我们生成insert语句，我们只需要知道原理即可。

#### 飞哥：
那我们怎么查询我们需要的数据呢？

#### 刘泓：
这就要用到SQL语言了！SQL的全拼是Structured Query Language，结构化查询语言。

**🎬 08-展示SQL查询语句**
最简单的SQL查询：

```sql
SELECT * FROM leaderboard;
```
翻译成人话就是："请把排行榜表的所有数据都给我看看"

查找高分玩家：
```sql
SELECT name, score FROM leaderboard WHERE score > 100;
```
翻译成人话："请给我看看分数大于100的玩家姓名和分数"

**🎬 09-展示SQL查询语句2**
常见的sql语句包括：
1. 查询语句（SELECT）
2. 插入语句（INSERT）
3. 更新语句（UPDATE）
4. 删除语句（DELETE）
也就是我们常说的“增删改查”。
大家不会写SQl也没关系，AI会帮我们生成这些SQL语句！

#### 飞哥：
让我们出第二道抢答题！
**🎬 10-展示抢答题2**
```
抢答题2：SQL语句 SELECT * FROM leaderboard 翻译成人话是什么意思？
  A. 删除排行榜表的所有数据
  B. 请把排行榜表的所有数据都给我看看
  C. 创建一个新的排行榜表
  D. 备份排行榜数据
  答案：B
```

### 三、实操：AI帮我们升级到数据库

#### 飞哥：
现在我们了解了数据库的基本原理，但是理论说得再多，不如实际操作一遍！请泓老师演示如何用AI帮我们升级到数据库！

#### 刘泓：
**🎬 投屏演示**
首先，大家可以在官网自行安装MySql数据库，安装过程中会需要设置一个root密码，这个密码需要记好，后面会用到。
现在我要告诉AI我们的具体需求。关键是要描述清楚现状和问题：

**🎬 11-展示提示词文本**
```
我们的贪吃蛇游戏现在用JSON文件存储排行榜数据，请帮我们升级到使用mysql数据库
```
这样AI就给我们生成了完整的升级方案！

#### 飞哥：
在这个过程中，AI帮我们做了什么？

#### 刘泓：
1. 创建数据库表：
```sql
CREATE TABLE leaderboard (
    id INTEGER PRIMARY KEY,
    name TEXT NOT NULL,
    score INTEGER NOT NULL,
    timestamp DATETIME DEFAULT CURRENT_TIMESTAMP
);
```

2. 升级后端代码：
```python
import sqlite3

# 连接数据库
conn = sqlite3.connect('gamedata.db')

# 提交分数到数据库
def save_score(name, score):
    cursor = conn.cursor()
    cursor.execute("INSERT INTO leaderboard (name, score) VALUES (?, ?)", 
                   (name, score))
    conn.commit()
```

3. 获取排行榜：
```python
def get_leaderboard():
    cursor = conn.cursor()
    cursor.execute("SELECT name, score FROM leaderboard ORDER BY score DESC LIMIT 10")
    return cursor.fetchall()
```
（演示修改参数）

**🎬 12-展示参数名文本**
连接数据库需要几个参数：
1. 主机名（Host）：数据库服务器的地址，通常是 localhost 或 IP 地址。
2. 端口号（Port）：数据库服务器监听的端口，默认是 3306。
3. 数据库名（Database Name）：要连接的具体数据库名称。
4. 用户名（Username）：登录数据库的用户名。
5. 密码（Password）：登录数据库的密码。

#### 飞哥：
所以我们其实不需要安装任何其他软件，只需要告诉AI一句话，“我们的贪吃蛇游戏现在用JSON文件存储排行榜数据，请帮我们升级到使用mysql数据库”，AI就帮我们完成了全过程。
对于用户来说，从他们的角度来看，从JSON文件升级到数据库，会感知到什么变化吗？

#### 刘泓：
因为我们只是改变了后端存储数据的形式，没有改变前端界面、或者增加用户登录等交互动作，所以对于用户来说，感知不到变化。
但这就像银行升级了保险柜系统，你存取钱的体验没变，但钱变得更安全了！

**🎬 13-展示选择题3**
```
选择题3:
数据库服务器地址的参数是？
A. host
B. port
C. database
D. username
正确答案：A
```

### 四、部署测试升级效果

#### 飞哥：
接下来，请泓老师给我们简单讲讲，如何把数据库部署到线上，替换我们之前的文件存储的形式。
关于部署的知识，大家了解原理即可，不需要掌握如何操作。

#### 刘泓：
**🎬 投屏演示**

升级步骤很简单：
（演示实际操作过程）
1. 运行数据库初始化脚本
2. 替换新的后端代码
3. 重启服务

现在让我们测试升级效果！

测试1：提交新分数
我来玩一局游戏...看，分数成功保存到数据库了！

测试2：多人同时访问
大家可以同时登陆游戏测试一下...完全没问题！

测试3：查询功能
现在我们可以轻松查询历史数据了！


### 六、尾声

#### 飞哥：
请泓老师给我们总结一下今天的知识点吧。

#### 刘泓：
**🎬 14-展示知识点总结**

本期核心知识：
1. 数据库原理：数据库本质上是一个结构化数据的智能仓库。它通过表结构建立数据之间的逻辑关系（比如用户表和订单表的关联），提供四大核心能力：持久化存储、高效检索、并发控制、数据安全。
2. 数据表的构成：
   1. 库：数据库的容器，用来组织和管理多个表。
   2. 表：数据库中的基本单位，用来存储数据。
   3. 字段：表中的列，用来存储具体的数据。
   4. 记录：表中的行，用来存储具体的数据实例。
3. 基本的Sql语句：
   1. 查询语句：SELECT
   2. 插入语句：INSERT
   3. 更新语句：UPDATE
   4. 删除语句：DELETE

有了数据库，我们的产品从"玩具级别"升级到了"商业级别"！

#### 飞哥：
现在我们的游戏数据已经很安全了，但还有个问题：排行榜上的名字都是大家随便起的，谁知道背后对应的是谁呢？比如这个叫“泓老师”的真的是你吗？

#### 刘泓：
下期我们将解决身份识别问题，建立用户登录系统，让排行榜显示真实的用户信息！

#### 飞哥：
那我们本期的课程就到这里了，从这节课开始，因为课程难度提升了，所以我们会在群里发布课后问卷，大家在实操过程中有什么疑问可以填写在问卷上，我们会在下一期给大家解答。

**🎬 15-展示课后作业说明**
本周的课后作业：将你们制作的游戏或应用升级到数据库存储。

现在开始进行激动人心的抽奖环节，从前9位抢答成功的同学中抽取3位幸运者，获得本期礼品一份，他们是xxx。

最后我们揭晓今天的互动榜第一，是xxx，将获得本期礼品一份。

记得完成我们的课后测验和作业，及时巩固自己的学习效果，下周同一时间我们不见不散！




### 测验题：
一、单选题题库

  1. 根据直播内容，文件存储方式的主要问题是什么？
  A. 文件会被自动删除
  B. 两个人同时提交分数可能出现数据冲突
  C. 文件格式不支持中文
  D. 占用磁盘空间太大
  答案：B

  2. 在第三期直播中，为什么要从文件存储升级到数据库？
  A. 因为JSON文件太大了
  B. 因为要解决并发访问和查询困难的问题
  C. 因为老师更喜欢数据库
  D. 因为数据库看起来更专业
  答案：B

  3. SQL语句 SELECT * FROM leaderboard 翻译成人话是什么意思？
  A. 删除排行榜表的所有数据
  B. 请把排行榜表的所有数据都给我看看
  C. 创建一个新的排行榜表
  D. 备份排行榜数据
  答案：B


  4. 数据库服务器地址的参数是？
A. host
B. port
C. database
D. username
正确答案：A


  ---
  二、多选题题库

  5. 数据库相比文件存储的优势包括哪些？（多选）
  A. 数据安全性更高，有自动备份
  B. 支持多人同时访问，无冲突
  C. 查询速度快，支持复杂查询
  D. 占用存储空间更小
  答案：ABC


  6. 完成数据库升级后，游戏获得了哪些新能力？（多选）
  A. 数据持久化
  B. 支持更多并发用户
  C. 可以进行复杂的数据查询
  D. 游戏界面变得更美观
  答案：ABC


  7. 数据库在哪些方面优于文件存储？（多选）
  A. 数据安全：银行级安全 vs 容易丢失
  B. 多人使用：轻松应对 vs 容易冲突
  C. 查询速度：秒级响应 vs 越来越慢
  D. 功能扩展：轻松添加 vs 需要重写
  答案：ABCD


  ---
  三、判断题题库

  8. SQL语言的全称是结构化管理语言。（　）
  答案：错误


  9. 数据库通过加锁的方式解决数据查询问题。（　）
  答案：错误


  10. AI可以帮助我们生成SQL语句，无需手动编写。（　）
  答案：正确




